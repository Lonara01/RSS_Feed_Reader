const express=require("express"),cors=require("cors"),Parser=require("rss-parser"),app=express(),PORT=3001,parser=new Parser;app.use(cors()),app.get("/api/rss",async(e,n)=>{const r=e.query.url;if(!r)return n.status(400).send("Missing url parameter");try{const e=(await parser.parseURL(r)).items.slice(0,10).map(e=>{let n="";if(e.enclosure?.url&&e.enclosure?.type?.startsWith("image/"))n=e.enclosure.url;else if(e.content){const r=e.content.match(/<img[^>]+src=["']([^"']+)["']/);r&&(n=r[1])}return{title:e.title||"",description:e.contentSnippet||e.content||"",link:e.link||"",imageUrl:n}});n.json(e)}catch(e){console.error("RSS parsing error:",e),n.status(500).send("Failed to fetch or parse RSS feed")}}),app.listen(3001,()=>console.log("Server running on http://localhost:3001")),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("load-feed"),n=document.getElementById("rss-url"),r=document.getElementById("news-container");function t(e){r.innerHTML='<div class="loading">Loading news feed...</div>',fetch(`http://localhost:3001/api/rss?url=${encodeURIComponent(e)}`).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{!function(e){if(!e||0===e.length)return void(r.innerHTML='<div class="loading">No news items found in the feed</div>');r.innerHTML="",e.forEach(e=>{const n=document.createElement("article");n.className="news-card";const t=e.imageUrl?`<img src="${e.imageUrl}" alt="${e.title}" class="news-image" onerror="this.src='https://via.placeholder.com/300x180?text=No+Image'">`:'<div class="news-image" style="background: #eee; display: flex; align-items: center; justify-content: center; color: #999;">No Image</div>';n.innerHTML=`\n        ${t}\n        <div class="news-content">\n          <h3 class="news-title">${e.title}</h3>\n          <p class="news-description">${e.description.substring(0,150)}...</p>\n          <a href="${e.link}" class="news-link" target="_blank" rel="noopener noreferrer">Read more</a>\n        </div>\n      `,r.appendChild(n)})}(e)}).catch(e=>{console.error("Error fetching RSS feed:",e),r.innerHTML=`<div class="loading">Error loading feed: ${e.message}</div>`})}t(n.value),e.addEventListener("click",()=>{const e=n.value.trim();e?t(e):alert("Please enter a valid RSS feed URL")})});